= javascript_include_tag "http://maps.googleapis.com/maps/api/js?sensor=false"

%h1
  =@checkpoint.name
  Checkpoint is currently
  -if @checkpoint.open
    %strong.green open
  -else
    %strong.red closed

%br/

%h4
  Text 312-836-7863 or tweet at 
  %a{:href => "https://www.twitter.com/testmaftuh", target: "_blank"}
    @testmaftuh 
  to update the status of this checkpoint (ex. "#{@checkpoint.name} is closed") 

%br/
%br/

.row
  .col-md-7
    #map-canvas{:style => "width: 650px; height: 400px"}

  .col-md-5
    -if @tweets.count > 0
      #chart
      = render_chart(@chart, 'chart')

%br/
%br/

.row
  .col-md-6
    %h3 Recent Reports
    %ul
      -@all_messages.each do |message|
        %li
          #{message.text} - 
          -if message.user
            %a{:href => "https://www.twitter.com/#{message.user.screen_name}", target: "_blank"}
              @#{message.user.screen_name}
          -else
            SMS
          \-
          %strong
            #{message.created_at.to_formatted_s(:long)}




%br/
%br/


=link_to 'Edit', edit_checkpoint_path(@checkpoint)
\|

=link_to 'Delete',  { action: :destroy, id: @checkpoint.id }, method: :delete, data: { confirm: 'Are you sure?' }

%script{:src => "https://maps.googleapis.com/maps/api/js?key=#{ENV['MAP_KEY']}", :type => "text/javascript"}
:javascript
  function initialize() {
    var geo

    var mapOptions = {
      center: { lat: #{@geo.first}, lng: #{@geo.last}},
      zoom: 9,
      mapTypeId: google.maps.MapTypeId.TERRAIN
    };
    var map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);
    var marker = new google.maps.Marker({
        position: {lat: #{@geo.first}, lng: #{@geo.last}},
        map: map,
        title:"#{@checkpoint.name} Checkpoint"
    });
  }
  google.maps.event.addDomListener(window, 'load', initialize);

